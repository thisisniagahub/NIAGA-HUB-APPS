{
  "query": "-- WOCS (WhatsApp OPS Control System) Database Schema\n-- For Abang Colek Brand OS\n\n-- Users & Roles\nCREATE TABLE IF NOT EXISTS wocs_users (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name VARCHAR(100) NOT NULL,\n  role VARCHAR(20) CHECK (role IN ('admin', 'agent', 'viewer')) NOT NULL,\n  wa_number VARCHAR(20) UNIQUE NOT NULL,\n  status VARCHAR(20) CHECK (status IN ('active', 'inactive')) DEFAULT 'active',\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- WhatsApp Sessions\nCREATE TABLE IF NOT EXISTS wocs_wa_sessions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES wocs_users(id) ON DELETE CASCADE,\n  session_data JSONB,\n  last_active TIMESTAMP DEFAULT NOW(),\n  status VARCHAR(20) CHECK (status IN ('connected', 'disconnected', 'banned')) DEFAULT 'disconnected',\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Tasks\nCREATE TABLE IF NOT EXISTS wocs_tasks (\n  id VARCHAR(20) PRIMARY KEY,\n  type VARCHAR(50) NOT NULL,\n  command_raw TEXT NOT NULL,\n  payload JSONB NOT NULL,\n  status VARCHAR(20) CHECK (status IN ('pending', 'awaiting_approval', 'running', 'done', 'failed', 'cancelled', 'rolled_back')) DEFAULT 'pending',\n  priority VARCHAR(10) CHECK (priority IN ('high', 'normal', 'low')) DEFAULT 'normal',\n  requested_by UUID REFERENCES wocs_users(id),\n  assigned_to UUID REFERENCES wocs_users(id),\n  scheduled_at TIMESTAMP,\n  started_at TIMESTAMP,\n  completed_at TIMESTAMP,\n  error_message TEXT,\n  result JSONB,\n  retry_count INT DEFAULT 0,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Task Logs\nCREATE TABLE IF NOT EXISTS wocs_task_logs (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  task_id VARCHAR(20) REFERENCES wocs_tasks(id) ON DELETE CASCADE,\n  action VARCHAR(50) NOT NULL,\n  actor_id UUID REFERENCES wocs_users(id),\n  details JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Indexes\nCREATE INDEX IF NOT EXISTS idx_wocs_tasks_status ON wocs_tasks(status);\nCREATE INDEX IF NOT EXISTS idx_wocs_tasks_assigned_to ON wocs_tasks(assigned_to);\nCREATE INDEX IF NOT EXISTS idx_wocs_tasks_created_at ON wocs_tasks(created_at DESC);\n\n-- Insert default admin users\nINSERT INTO wocs_users (name, role, wa_number) \nVALUES \n  ('Admin 1', 'admin', '01168444656'),\n  ('Admin 2', 'admin', '0178245667')\nON CONFLICT (wa_number) DO NOTHING;",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 4Uyem49BFgjToRh.root --database 8mzsfSMdeqU2CbBePkkZ5Q --execute -- WOCS (WhatsApp OPS Control System) Database Schema\n-- For Abang Colek Brand OS\n\n-- Users & Roles\nCREATE TABLE IF NOT EXISTS wocs_users (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  name VARCHAR(100) NOT NULL,\n  role VARCHAR(20) CHECK (role IN ('admin', 'agent', 'viewer')) NOT NULL,\n  wa_number VARCHAR(20) UNIQUE NOT NULL,\n  status VARCHAR(20) CHECK (status IN ('active', 'inactive')) DEFAULT 'active',\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- WhatsApp Sessions\nCREATE TABLE IF NOT EXISTS wocs_wa_sessions (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  user_id UUID REFERENCES wocs_users(id) ON DELETE CASCADE,\n  session_data JSONB,\n  last_active TIMESTAMP DEFAULT NOW(),\n  status VARCHAR(20) CHECK (status IN ('connected', 'disconnected', 'banned')) DEFAULT 'disconnected',\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Tasks\nCREATE TABLE IF NOT EXISTS wocs_tasks (\n  id VARCHAR(20) PRIMARY KEY,\n  type VARCHAR(50) NOT NULL,\n  command_raw TEXT NOT NULL,\n  payload JSONB NOT NULL,\n  status VARCHAR(20) CHECK (status IN ('pending', 'awaiting_approval', 'running', 'done', 'failed', 'cancelled', 'rolled_back')) DEFAULT 'pending',\n  priority VARCHAR(10) CHECK (priority IN ('high', 'normal', 'low')) DEFAULT 'normal',\n  requested_by UUID REFERENCES wocs_users(id),\n  assigned_to UUID REFERENCES wocs_users(id),\n  scheduled_at TIMESTAMP,\n  started_at TIMESTAMP,\n  completed_at TIMESTAMP,\n  error_message TEXT,\n  result JSONB,\n  retry_count INT DEFAULT 0,\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Task Logs\nCREATE TABLE IF NOT EXISTS wocs_task_logs (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  task_id VARCHAR(20) REFERENCES wocs_tasks(id) ON DELETE CASCADE,\n  action VARCHAR(50) NOT NULL,\n  actor_id UUID REFERENCES wocs_users(id),\n  details JSONB,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Indexes\nCREATE INDEX IF NOT EXISTS idx_wocs_tasks_status ON wocs_tasks(status);\nCREATE INDEX IF NOT EXISTS idx_wocs_tasks_assigned_to ON wocs_tasks(assigned_to);\nCREATE INDEX IF NOT EXISTS idx_wocs_tasks_created_at ON wocs_tasks(created_at DESC);\n\n-- Insert default admin users\nINSERT INTO wocs_users (name, role, wa_number) \nVALUES \n  ('Admin 1', 'admin', '01168444656'),\n  ('Admin 2', 'admin', '0178245667')\nON CONFLICT (wa_number) DO NOTHING;",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 5: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 2 column 10 near \"UUID PRIMARY KEY DEFAULT gen_random_uuid(),",
    "  name VARCHAR(100) NOT NULL,",
    "  role VARCHAR(20) CHECK (role IN ('admin', 'agent', 'viewer')) NOT NULL,",
    "  wa_number VARCHAR(20) UNIQUE NOT NULL,",
    "  status VARCHAR(20) CHECK (status IN ('active', 'inactive')) DEFAULT 'active',",
    "  created_at TIMESTAMP DEFAULT NOW(),",
    "  updated_at TIMESTAMP DEFAULT NOW()",
    ")\""
  ]
}